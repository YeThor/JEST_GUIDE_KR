# Mock Functions

> Mock: 흉내내다

Mock function은 함수의 실제 구현체를 지움으로써 코드 간의 연결 관계를 쉽게 테스트할 수 있게 도와줍니다. 특정 함수의 호출 유무, 호출시 어떤 파라미터가 전달되었는지, `new`로 인스턴스화된 함수, 시간에 따라 변하는 리턴 값 등을 확인할 수 있습니다. <!-- //FIXME: 해당 문단 이해가 부족하여 해석이 부자연스러움 -- >

함수를 Mocking 하는 데에는 2가지 방법이 있습니다. 하나는 테스트 코드에 쓸 mock function을 만드는 것이고, 다른 하나는 의존성 모듈을 덮어씌우는 `manual mock`을 만드는 것입니다.

## Using a mock function

> 목 함수 사용하기

`forEach` 함수를 테스트한다고 상상해봅시다. `forEach`는 전달받은 배열의 각 아이템에 대해 callback 함수를 호출합니다.

```js
function forEach(items, callback) {
  for (let index = 0; index < items.length; index++) {
    callback(items[index]);
  }
}
```

이 함수를 테스트하기 위해서, 우리는 mock function을 쓸 수 있습니다. callback 함수가 기대한 대로 호출되었는지 확인하기 위해 mock의 상태를 확인할 수 있습니다.

```js
const mockCallback = jest.fn(x => 42 + x);
forEach([0, 1], mockCallback);

// mock function은 2번 호출된다
expect(mockCallback.mock.calls.length).toBe(2);

// 함수 첫번째 호출시 전달인자는 0이다.
expect(mockCallback.mock.calls[0][0]).toBe(0);

// 함수 두번째 호출시 전달인자는 1이다
expect(mockCallback.mock.calls[1][0]).toBe(1);

// 함수 첫 호출시 리턴 값은 42다.
expect(mockCallback.mock.results[0].value).toBe(42);
```

## `.mock` Property

모든 mock function은 `.mock`이라는 특별한 프로퍼티를 가지고 있습니다. 이 프로퍼티에는 함수의 호출 방식과 리턴값에 대한 데이터가 저장되어 있습니다. 또한 이 `.mock` 프로퍼티는 각각의 콜에 대해 `this` 값을 추적하고 있기 때문에, 다음처럼 활용할 수도 있습니다.

```js
const myMock = jest.fn();

const a = new myMock();
const b = {};
const bound = myMock.bind(b);
bound();

console.log(myMock.mock.instances);
// [ <a>, <b>]
// FIXME: 실제 코드 출력결과가 어떤지 확인해보기
```

`mock`의 구성요소들은 함수들이 어떻게 호출되었는지, 어떻게 인스턴스화되었는지 혹은 무엇을 리턴하고 있는지를 assert할 때 테스트에서 아주 유용하게 쓸 수 있습니다.

```js
// 함수는 정확히 한 번 호출된다.
expect(someMockFunction.mock.calls.length).toBe(1);

// 함수 첫번째 호출시 첫번째 전달인자는 'first arg'이다
expect(someMockFunction.mock.calls[0][0]).toBe("first arg");

// 함수 첫번째 호출시 두번째 전달인자는 'second arg'이다.
expect(someMockFunction.mock.calls[0][1]).toBe("second arg");

// 함수 첫번째 호출시 리턴값은 'return value' 이다.
expect(someMockFunction.mock.results[0].value).toBe("return value");

// 함수는 정확히 두 번 인스턴스화되었다.
expect(someMockFunction.mock.instances.length).toBe(2);

// 이 함수의 첫번째 인스턴스가 리턴한 객체는 'test'라는 값을 가진 'name' 프로퍼티를 가지고 있다.
expect(someMockFunction.mock.instances[0].name).toEqual("test");
```
